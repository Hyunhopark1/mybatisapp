<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Category List</title>
    <link rel="stylesheet" href="/mazer/assets/compiled/css/app.css">
    <link rel="stylesheet" href="/mazer/assets/compiled/css/app-dark.css">
    <link rel="stylesheet" href="/mazer/assets/compiled/css/iconly.css">
    <script language="JavaScript" src="/js/jquery-3.7.1.min.js"></script>
    <script th:inline="javascript">
        //$(document).ready(function(){
        //    // Jquery 는 html 문서가 로딩이 완료 되면 이 부분을 실행한다.
        //});
        $(function(){
            // jQuery 3.0 버전부터 실행할 기능을 정의해주세요.
            let totPage = ~~(([[${searchCategoryDto.total}]] + 9) / 10);
            let page = [[${searchCategoryDto.page}]];
            let startPage = getStartPage(page);
            let endPage = getEndPage(startPage);
            let searchName = [[${searchCategoryDto.name}]];
            let sClass = "btn btn-success rounded-pill";
            let prev = (page-1) < 1 ? 1 : page-1;
            let next = (page+1) >= totPage ? totPage : page+1;

            $("#pageDiv").append(" <a class='" + sClass + "' href='category_list?page=" + prev +
                "&name=" + searchName + "'>Prev</a> ");
            for (let i = startPage; i <= endPage; i++) {
                if (page == i) {
                    sClass = "btn btn-primary rounded-pill";
                }
                $("#pageDiv").append(" <a class='" + sClass + "' href='category_list?page=" + i +
                    "&name=" + searchName + "'>" + i + "</a> ");
                sClass = "btn btn-success rounded-pill";
            }
            $("#pageDiv").append(" <a class='" + sClass + "' href='category_list?page=" + next +
                "&name=" + searchName + "'>Next</a> ");
        });

        function getStartPage(page) {
            // 1~10 => 1, 11~20 => 11, 21~30 => 21
            // let startPage = ((page - 1) / 10) * 10 + 1;
            let one = 1;
            let ten = ~~((page - 1) / 10) * 10;
            let startPage = ten + one;
            return ~~(startPage);
        }

        function getEndPage(startPage) {
            // page 1~10 : total 35 : (1, 2, 3, 4)
            // page 1~10 : total 90 : (1, 2, 3, 4, 5, 6, 7, 8, 9)
            // page 1~10 : total 159 : (1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
            // page 11~20 : total 159 : (11, 12, 13, 14, 15)
            // page 11~20 : total 222 : (11, 12, 13, 14, 15, 16, 17, 18, 19, 20)
            // page 21~30 : total 222 : (21, 22, 23)
            let totPage = ~~(([[${searchCategoryDto.total}]] + 9) / 10);
            let tPage = startPage + 9;
            if ( tPage < totPage ) {
                return ~~(tPage);
            }
            return ~~(totPage);
        }
    </script>
    <style>

        .form-container {
            width: 100%;
            text-align: center;
            font-family:  cursive;
        }


        #search-form {
            display: flex;
            align-items: center;
            gap: 10px; /* 요소 사이의 간격 */
        }

        #search-form > label{
            flex : 1;
            float: left;
            padding : 40px 150px;
            margin:10px;
            font-size: 20px;
            font-weight: 800;
        }
        #search-form > input{
            float: left;
            border: 1px solid black;
            padding : 40px 150px;
            margin:10px;
            font-size: 20px;
            font-weight: 800;
        }
        #search-form input[type="text"] {
            flex: 2;
            width: 100%;
        }
        #search-form input[type="submit"] {
            flex: 1;
            border-radius: 30px;
            background: dodgerblue;
            color:#ffffff;
            cursor: pointer;
        }
        .category-list{
            border:1px solid black;
            display: flex;
            flex-direction: column;
        }
        .buttons{
            display: flex;
            justify-content: center; /* 버튼을 중앙으로 정렬 */
            margin-top: auto; /* 컨테이너의 하단에 위치하도록 */
            padding: 10px; /* 버튼 주위에 여백 추가 */
        }
        .btn-insert{
            width:200px;
            float:right;
        }
        .btn-insert a {
            display: block;
            text-decoration: none;
            color: white;
            padding: 10px;
            border-radius: 5px;
        }
        .page-container{
            display: flex;
            align-items: center; /* 세로 정렬을 중앙으로 설정 */
            justify-content: space-between; /* 요소들 사이에 균등한 간격을 설정 */
        }


        .page-container a {
            text-decoration: none; /* 링크 기본 스타일 제거 */
            color: inherit; /* 링크 색상 상속 */
        }

        #page {
            list-style: none; /* 리스트 기본 스타일 제거 */
            padding: 0; /* 패딩 제거 */
            margin: 0; /* 마진 제거 */
            display: flex; /* 리스트 항목들을 수평으로 배치 */
            align-items: center; /* 세로 정렬을 중앙으로 설정 */
        }

        #page li {
            margin: 0 5px; /* 리스트 항목 사이에 간격 추가 */
        }
        #page-box {
            padding : 10px;
        }
    </style>

</head>
<body>
<!--검색 -->
<div class="form-container">
    <form id="search-form" name="search-form" method="get" action="/catweb/category_search" th:object="${searchCategoryDto}">
        <label for="search-name">이름</label>
        <input type="text" id="search-name" name="name" placeholder="검색할 이름 입력" autofocus th:value="${searchCategoryDto.name}"/>
        <input type="submit" value="검색"/>
    </form>
</div>
<!-- 리스트 -->
<div class="category-list">
<section id="content-types">
    <div class="row">
        <div class="col-xl-4 col-md-6 col-sm-12" th:each="node : ${allList}">
            <div class="card">
                <a th:href="@{/catweb/category_view(id=${node.id})}">
                    <div class="card-content">
                        <div class="card-body" th:text="${node.id}"></div>
                        <div class="card-text" th:text="${node.name}"></div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</section>
    <!--추가 버튼-->
    <div class="buttons">
        <button class="btn btn-info btn-insert"><a href="/catweb/category_add">추가</a></button>
    </div>
    <div>total : [[${searchCategoryDto.total}]]</div>

</div>

<!--페이지 & 페이지 이동 버튼-->
<div class="page-container">
    <div id="pageDiv">
    </div>
</div>

</body>
</html>